<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>小海控制台 | 發文系統</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Microsoft JhengHei', sans-serif; background-color: #f3f4f6; }
        .login-screen { display: flex; }
        .dashboard-screen { display: none; }
    </style>
</head>
<body>

    <!-- 1. 登入畫面 -->
    <div id="loginSection" class="min-h-screen flex items-center justify-center login-screen px-4">
        <div class="bg-white p-8 rounded-2xl shadow-xl w-full max-w-md border border-gray-100">
            <div class="text-center mb-8">
                <div class="w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-lock text-white text-2xl"></i>
                </div>
                <h2 class="text-2xl font-bold text-gray-800">管理員登入</h2>
                <p class="text-gray-500 text-sm mt-2">請輸入管理密碼進入發文系統</p>
            </div>
            <div class="space-y-4">
                <div>
                    <!-- 密碼輸入框 -->
                    <input type="password" id="passwordInput" placeholder="請輸入密碼..." 
                        class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition text-center tracking-widest text-lg">
                </div>
                <button onclick="checkLogin()" 
                    class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg transition duration-200 transform active:scale-95">
                    驗證身分
                </button>
                <div class="text-center">
                    <a href="index.html" class="text-sm text-gray-400 hover:text-gray-600">回首頁</a>
                </div>
            </div>
        </div>
    </div>

    <!-- 2. 發文後台 (登入後顯示) -->
    <div id="dashboardSection" class="min-h-screen dashboard-screen flex-col">
        <!-- Navbar -->
        <nav class="bg-white shadow-sm border-b border-gray-200 px-6 py-4 flex justify-between items-center">
            <div class="flex items-center gap-2">
                <i class="fas fa-pen-nib text-blue-600"></i>
                <h1 class="font-bold text-gray-800 text-lg">小海發文系統</h1>
            </div>
            <div class="flex items-center gap-4">
                <a href="index.html" class="text-gray-500 hover:text-blue-600 text-sm font-medium transition">
                    <i class="fas fa-home mr-1"></i> 回首頁
                </a>
                <button onclick="logout()" class="text-gray-500 hover:text-red-500 text-sm font-medium transition">
                    <i class="fas fa-sign-out-alt mr-1"></i> 登出
                </button>
            </div>
        </nav>

        <main class="flex-1 max-w-3xl w-full mx-auto p-6">
            <div class="bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden">
                <div class="p-6 border-b border-gray-100 bg-gray-50">
                    <h3 class="font-bold text-gray-700">撰寫新文章</h3>
                </div>
                
                <div class="p-6 space-y-6">
                    <!-- 標題 -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">文章標題</label>
                        <input type="text" id="postTitle" class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 outline-none" placeholder="例如：2023.12.11 盤後分析">
                    </div>

                    <!-- 分類 -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">文章分類</label>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                            <label class="cursor-pointer">
                                <input type="radio" name="category" value="盤前分析" class="peer sr-only" checked>
                                <div class="text-center py-2 border rounded-lg peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-600 hover:bg-gray-50 transition">盤前分析</div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="category" value="盤後分析" class="peer sr-only">
                                <div class="text-center py-2 border rounded-lg peer-checked:bg-indigo-600 peer-checked:text-white peer-checked:border-indigo-600 hover:bg-gray-50 transition">盤後分析</div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="category" value="周末分析" class="peer sr-only">
                                <div class="text-center py-2 border rounded-lg peer-checked:bg-purple-600 peer-checked:text-white peer-checked:border-purple-600 hover:bg-gray-50 transition">周末分析</div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="category" value="心態分享" class="peer sr-only">
                                <div class="text-center py-2 border rounded-lg peer-checked:bg-amber-500 peer-checked:text-white peer-checked:border-amber-500 hover:bg-gray-50 transition">心態分享</div>
                            </label>
                        </div>
                    </div>

                    <!-- 內容 -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">內容 (支援換行)</label>
                        <textarea id="postContent" rows="12" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 outline-none resize-y" placeholder="在這裡輸入文章內容..."></textarea>
                    </div>

                    <!-- 按鈕 -->
                    <button id="submitBtn" onclick="submitPost()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-xl shadow-lg shadow-blue-200 transition transform active:scale-[0.98] flex items-center justify-center gap-2">
                        <i class="fas fa-paper-plane"></i> 發布文章
                    </button>
                </div>
            </div>
        </main>
    </div>

    <!-- Firebase Script -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyB3_iiersG3Fff4oj_ouyu_lLs3flzPmKE",
            authDomain: "littlesea-web.firebaseapp.com",
            projectId: "littlesea-web",
            storageBucket: "littlesea-web.firebasestorage.app",
            messagingSenderId: "796678723012",
            appId: "1:796678723012:web:6c501411714c2f49960091",
            measurementId: "G-W8GSXYYY9L"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // 自動匿名登入以確保有寫入權限
        signInAnonymously(auth).then(() => {
            console.log("Connected");
        }).catch((error) => {
            console.error("Connection Error", error);
        });

        window.submitPost = async function() {
            const title = document.getElementById('postTitle').value;
            const content = document.getElementById('postContent').value;
            const category = document.querySelector('input[name="category"]:checked').value;
            const btn = document.getElementById('submitBtn');

            if (!title || !content) {
                alert("標題和內容不能為空！");
                return;
            }

            try {
                btn.disabled = true;
                btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> 發布中...';

                // 注意：這裡寫入的是 "posts" 集合，跟首頁讀取的是一致的
                await addDoc(collection(db, "posts"), {
                    title: title,
                    content: content,
                    category: category,
                    author: "小海",
                    timestamp: serverTimestamp()
                });

                alert("發布成功！");
                document.getElementById('postTitle').value = '';
                document.getElementById('postContent').value = '';
            } catch (e) {
                console.error("Error adding document: ", e);
                alert("發布失敗，請檢查網路連線。");
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-paper-plane"></i> 發布文章';
            }
        }
    </script>

    <script>
        // ============================================
        //  【在此處修改您的密碼】
        //   將 "0712" 改成您想要的數字或文字即可
        // ============================================
        const ADMIN_PASSWORD = "0712"; 
        // ============================================


        function checkLogin() {
            const pwd = document.getElementById('passwordInput').value;
            
            // 檢查密碼是否正確
            if (pwd === ADMIN_PASSWORD) {
                document.getElementById('loginSection').style.display = 'none';
                document.getElementById('dashboardSection').style.display = 'flex';
                // 登入成功後儲存狀態
                localStorage.setItem('littlesea_admin', 'true');
            } else {
                alert("密碼錯誤，請重新輸入！");
                document.getElementById('passwordInput').value = '';
                document.getElementById('passwordInput').focus();
            }
        }

        function logout() {
            localStorage.removeItem('littlesea_admin');
            location.reload();
        }

        // 檢查瀏覽器是否已記錄登入狀態，若有則直接進入後台
        if (localStorage.getItem('littlesea_admin') === 'true') {
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('dashboardSection').style.display = 'flex';
        }
    </script>
</body>
</html>